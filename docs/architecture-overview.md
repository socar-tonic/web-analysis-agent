# Web Analysis Agent - 아키텍처 개요

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              배치 서버 (기존)                                 │
│   [로그인] → [차량검색] → [할인권적용] → [확인]                                │
│                           │ 실패 시                                          │
│                           ▼                                                 │
│                    슬랙 알림 발송                                             │
└─────────────────────────────┬───────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                         Web Analysis Agent                                   │
│                                                                             │
│  ┌────────────────────────────────────────────────────────────────────┐     │
│  │  1. Alert Receiver                                                 │     │
│  │     슬랙 알림 수신 → 장비사 ID 추출                                   │     │
│  └────────────────────────────────┬───────────────────────────────────┘     │
│                                   │                                         │
│                                   ▼                                         │
│  ┌────────────────────────────────────────────────────────────────────┐     │
│  │  2. Analyzer (Playwright)                                          │     │
│  │     사이트 접속 → DOM 캡처 → 네트워크(Fetch/XHR) 캡처                  │     │
│  └────────────────────────────────┬───────────────────────────────────┘     │
│                                   │                                         │
│                    ┌──────────────┴──────────────┐                          │
│                    │                             │                          │
│              접속 실패                        접속 성공                       │
│                    │                             │                          │
│                    ▼                             ▼                          │
│  ┌─────────────────────────┐    ┌─────────────────────────────────────────┐ │
│  │  규칙 기반 판정          │    │  ★★★ AI (LLM) 역할 ★★★                  │ │
│  │  (LLM 불필요)           │    │                                         │ │
│  │                         │    │  ┌─────────────────────────────────┐   │ │
│  │  SERVER_OR_FIREWALL     │    │  │ 1. DOM diff 분석                 │   │ │
│  │  - timeout              │    │  │    기존 spec vs 현재 DOM 비교     │   │ │
│  │  - connection refused   │    │  │    "어떤 셀렉터가 바뀌었는가?"    │   │ │
│  │  - 5xx 에러             │    │  └─────────────────────────────────┘   │ │
│  │                         │    │                  ↓                     │ │
│  └───────────┬─────────────┘    │  ┌─────────────────────────────────┐   │ │
│              │                  │  │ 2. 변경점 분석                    │   │ │
│              │                  │  │    "button#login이                │   │ │
│              │                  │  │     button.new-login-btn으로      │   │ │
│              │                  │  │     변경됨"                       │   │ │
│              │                  │  └─────────────────────────────────┘   │ │
│              │                  │                  ↓                     │ │
│              │                  │  ┌─────────────────────────────────┐   │ │
│              │                  │  │ 3. 수정 코드 생성                  │   │ │
│              │                  │  │    기존 배치 코드를 분석하여        │   │ │
│              │                  │  │    새 셀렉터로 수정된 코드 제안     │   │ │
│              │                  │  └─────────────────────────────────┘   │ │
│              │                  │                                         │ │
│              │                  │  결과: SIGNATURE_CHANGED                │ │
│              │                  └───────────────────┬─────────────────────┘ │
│              │                                      │                       │
│              ▼                                      ▼                       │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  3. Action Dispatcher                                               │   │
│  │                                                                     │   │
│  │   SERVER_OR_FIREWALL              SIGNATURE_CHANGED                 │   │
│  │          │                               │                          │   │
│  │          ▼                               ▼                          │   │
│  │   ┌────────────┐                ┌─────────────────────┐             │   │
│  │   │ 슬랙 알림   │                │ GitHub MCP          │             │   │
│  │   │ "서버 다운  │                │                     │             │   │
│  │   │  추정"     │                │ 1. 기존 코드 조회    │             │   │
│  │   └────────────┘                │ 2. AI 제안 코드 적용 │             │   │
│  │                                 │ 3. Draft PR 생성    │             │   │
│  │                                 └──────────┬──────────┘             │   │
│  │                                            │                        │   │
│  │                                            ▼                        │   │
│  │                                 ┌─────────────────────┐             │   │
│  │                                 │ 슬랙 알림            │             │   │
│  │                                 │ "@운영팀             │             │   │
│  │                                 │  시그니처 변경 감지   │             │   │
│  │                                 │  Draft PR: [링크]"  │             │   │
│  │                                 └─────────────────────┘             │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## AI (LLM) 역할 요약

```
┌─────────────────────────────────────────────────────────────────┐
│                        ★ AI (LLM) 담당 ★                        │
│                                                                 │
│   입력:                                                         │
│   - 캡처된 DOM 구조                                              │
│   - 캡처된 네트워크 로그 (Fetch/XHR)                              │
│   - 기존 장비사 spec (기대하는 셀렉터/API)                         │
│   - 기존 배치 코드                                               │
│                                                                 │
│   ─────────────────────────────────────────────────────────     │
│                                                                 │
│   분석:                                                         │
│   1. "어떤 셀렉터/API가 변경되었는가?"                             │
│   2. "변경 전 vs 변경 후 차이점은?"                                │
│   3. "기존 코드를 어떻게 수정해야 하는가?"                          │
│                                                                 │
│   ─────────────────────────────────────────────────────────     │
│                                                                 │
│   출력:                                                         │
│   - 진단 결과 (SIGNATURE_CHANGED 등)                             │
│   - 변경점 설명 (before/after)                                   │
│   - 수정된 코드 제안                                             │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 핵심 흐름 한눈에

```
실패 알림
    │
    ▼
접속 시도 ───┬─── 실패 ──→ [규칙] ──→ 서버/방화벽 ──→ 슬랙
             │
             └─── 성공 ──→ [AI/LLM] ──→ 시그니처 변경 ──→ Draft PR ──→ 슬랙
                              │
                              ├─ DOM diff 분석
                              ├─ 변경점 파악
                              └─ 수정 코드 생성
```
